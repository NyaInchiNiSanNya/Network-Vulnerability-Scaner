using System;
using System.Collections.Generic;
using System.Data.SqlClient;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Services.PacketsAnalizator
{
    internal class _1433SQLserver
    {

        internal static Dictionary<String, String> SQLServerScanner(String host)
        {
            Dictionary<String, String> ScannerResult = new Dictionary<String, String>();


            ScannerResult.Add("Service","MS-SQL-SERVER");
            //требуется настройка строки подключения для корректной работы на удаленном хосте
            ScannerResult.Add("Version", GetServerVersion(host));

            return ScannerResult;
        }

        internal static String GetServerVersion(String host)
        {

            string connectionString = "Server=UNDERGROUND-PC;Database=master;Trusted_Connection=True;";
            using (SqlConnection connection = new SqlConnection(connectionString))
            {
                String Response = String.Empty;
                connection.Open();
                SqlCommand command = new SqlCommand("SELECT @@VERSION", connection);
                SqlDataReader reader = command.ExecuteReader();
                while (reader.Read())
                {
                    Response += reader.GetString(0);
                }
                string[] lines = Response.Split('\n');
                return lines[0];
            }

        }
    }
}
